<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard | Tourist Gateway</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <i class="fas fa-chart-line logo-icon"></i>
                <span>Manager Dashboard</span>
            </div>
            <div class="nav-links">
                <a href="tourist.html" class="nav-link">
                    <i class="fas fa-user"></i> View Tourist Page
                </a>
                <div class="user-info">
                    <span id="userEmail"></span>
                    <button class="btn btn-danger btn-sm" onclick="SessionManager.logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Stats Overview -->
        <div class="card mb-6">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-chart-bar"></i> Service Overview</h3>
                <p class="card-subtitle">Real-time booking statistics and insights</p>
            </div>
            <div class="grid grid-3 gap-4" id="statsSummary">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600" id="totalBookings">0</div>
                    <div class="text-sm text-gray-600">Total Bookings</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600" id="activeBookings">0</div>
                    <div class="text-sm text-gray-600">Active Today</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <div class="text-2xl font-bold text-purple-600" id="popularTaxi">N/A</div>
                    <div class="text-sm text-gray-600">Most Popular Taxi</div>
                </div>
            </div>
        </div>

        <!-- Manage Bookings -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-clipboard-list"></i> Manage Bookings</h3>
                <p class="card-subtitle">View and manage all taxi bookings</p>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Booking ID</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Route</th>
                            <th>Scheduled Time</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="managerBookingList">
                        <tr>
                            <td colspan="7" class="text-center py-8 text-gray-400">
                                Loading bookings...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="flex justify-between mt-4">
                <button class="btn btn-primary" onclick="ManagerDashboard.loadAllBookings()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="btn btn-secondary" onclick="exportBookings()">
                    <i class="fas fa-download"></i> Export CSV
                </button>
            </div>
        </div>
    </div>

    <script src="../js/main.js"></script>
    <script>
        // Load manager data on page load
        document.addEventListener('DOMContentLoaded', async () => {
            const user = await SessionManager.checkSession();
            if (user && (user.role === 'Manager' || user.role === 'Admin')) {
                SessionManager.updateUserUI(user);
                ManagerDashboard.loadAllBookings();
                loadStats();
            } else {
                window.location.href = 'tourist.html';
            }
        });

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stat/view_stats.php`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalBookings').textContent = 
                        data.statistics.total_bookings || 0;
                    document.getElementById('activeBookings').textContent = 
                        data.statistics.active_today || 0;
                    document.getElementById('popularTaxi').textContent = 
                        data.statistics.most_popular_taxi?.vehicle_type || 'N/A';
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        function exportBookings() {
            Utils.showToast('Export feature coming soon!', 'info');
        }
    </script>
</body>
</html>