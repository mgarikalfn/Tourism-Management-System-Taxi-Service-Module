<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Gateway | Travel Services</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <i class="fas fa-globe-africa logo-icon"></i>
                <span>Tourist Gateway</span>
            </div>
            <div class="nav-links">
                <a href="tourist.html" class="nav-link active" id="navTaxis"><i class="fas fa-taxi"></i> Taxis</a>
                <a href="#" class="nav-link" id="navHotels" onclick="showHotelDiscovery()"><i class="fas fa-hotel"></i> Hotels</a>
                <a href="#" class="nav-link" id="navRestaurants" onclick="showRestaurantDiscovery()"><i class="fas fa-utensils"></i> Restaurants</a>
                
                <!-- Dashboard link will be inserted here for managers/admins -->
                
                <div class="user-info">
                    <span id="userEmail" class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="userEmailText"></span>
                    </span>
                    
                    <!-- Dashboard button in user info (alternative) -->
                    <button id="userDashboardBtn" class="btn btn-warning btn-sm" style="display: none;" 
                            onclick="window.location.href='manager.html'" title="Go to Manager Dashboard">
                        <i class="fas fa-chart-line"></i>
                    </button>
                    
                    <button class="btn btn-danger btn-sm" onclick="SessionManager.logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Explore Ethiopia with Ease</h1>
            <p>Your one-stop destination for seamless travel experiences across Ethiopia</p>
            <div class="flex justify-center gap-3 mt-4">
                <button class="btn btn-outline" onclick="TaxiService.loadTaxis()">
                    <i class="fas fa-sync-alt"></i> Refresh Taxis
                </button>
                <button class="btn btn-secondary" onclick="BookingService.loadUserBookings()">
                    <i class="fas fa-history"></i> View History
                </button>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Taxi Services Section -->
        <div id="taxi-services" class="main-service-section">
            <div class="grid grid-auto mb-6">
                <!-- Available Taxis -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-taxi"></i> Available Taxis</h3>
                        <p class="card-subtitle">Select a taxi for your journey</p>
                    </div>
                    <div id="taxiList" class="mb-3">
                        <p class="text-center text-gray-400">Loading available taxis...</p>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="TaxiService.loadTaxis()">
                        <i class="fas fa-sync-alt"></i> Refresh Taxi List
                    </button>
                </div>

                <!-- Taxi Booking Form -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-calendar-check"></i> Book a Ride</h3>
                        <p class="card-subtitle">Fill in your travel details</p>
                    </div>
                    
                    <!-- Selected Taxi Banner -->
                    <div id="selectionBanner" class="hidden bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 mb-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-sm text-gray-600">Selected Taxi:</span>
                                <strong class="block text-lg" id="selectedTaxiName"></strong>
                            </div>
                            <button class="btn btn-sm" onclick="document.getElementById('selectionBanner').classList.add('hidden')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Hidden Taxi ID -->
                    <input type="hidden" id="taxiId">
                    
                    <!-- Booking Form -->
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="form-label" for="pickup_time"><i class="fas fa-clock"></i> Pickup Date & Time</label>
                            <input type="datetime-local" id="pickup_time" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="pickup"><i class="fas fa-map-marker-alt"></i> Pickup Location</label>
                            <input type="text" id="pickup" class="form-control" placeholder="Enter pickup address" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="dropoff"><i class="fas fa-flag-checkered"></i> Drop-off Location</label>
                            <input type="text" id="dropoff" class="form-control" placeholder="Enter destination" required>
                        </div>
                        
                        <button id="confirmBtn" class="btn btn-success btn-full" onclick="TaxiService.bookTaxi()" disabled>
                            <i class="fas fa-check-circle"></i> Confirm Booking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hotel Discovery Section -->
        <div class="card" id="hotel-discovery" style="display:none; margin-top: 25px; border-top: 4px solid #f59e0b;">
            <div class="card-header">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h3 class="card-title"><i class="fas fa-hotel"></i> Available Hotels</h3>
                        <p class="card-subtitle">Find and book accommodations across Ethiopia</p>
                    </div>
                    <button class="btn btn-secondary" style="width:auto" onclick="hideHotelDiscovery()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
            
            <div class="mb-4">
                <div class="flex gap-2">
                    <input type="text" id="hotelSearch" class="form-control" placeholder="Search hotels..." 
                           onkeyup="searchHotels()">
                    <select id="hotelPriceRange" class="form-control" style="width: 200px;" onchange="filterHotels()">
                        <option value="">All Price Ranges</option>
                        <option value="$">Budget ($)</option>
                        <option value="$$">Moderate ($$)</option>
                        <option value="$$$">Luxury ($$$)</option>
                    </select>
                    <select id="hotelRating" class="form-control" style="width: 200px;" onchange="filterHotels()">
                        <option value="0">All Ratings</option>
                        <option value="4">4+ Stars</option>
                        <option value="3">3+ Stars</option>
                    </select>
                </div>
            </div>
            
            <div id="hotel-grid" class="grid grid-3" style="margin-top:15px;">
                <p class="text-center text-gray-400 col-span-3">Loading hotels...</p>
            </div>
            
            <div class="mt-4 text-center">
                <button class="btn btn-outline" onclick="loadMoreHotels()">
                    <i class="fas fa-plus"></i> Load More Hotels
                </button>
            </div>
        </div>

        <!-- Hotel Booking Form -->
        <div id="hotel-booking-form" class="card" style="display:none; margin-top: 20px; border-top: 4px solid #f59e0b;">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-calendar-alt"></i> Confirm Hotel Reservation</h3>
                <p class="card-subtitle">Complete your hotel booking</p>
            </div>
            
            <div class="space-y-4">
                <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                    <p class="text-sm text-gray-600">Hotel:</p>
                    <strong class="text-lg" id="selected-hotel-name"></strong>
                    <p class="text-sm mt-1" id="selected-hotel-address"></p>
                </div>
                
                <input type="hidden" id="ext-hotel-id">
                
                <div class="grid grid-2 gap-4">
                    <div class="form-group">
                        <label class="form-label" for="check-in"><i class="fas fa-sign-in-alt"></i> Check-in Date</label>
                        <input type="date" id="check-in" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="check-out"><i class="fas fa-sign-out-alt"></i> Check-out Date</label>
                        <input type="date" id="check-out" class="form-control" required>
                    </div>
                </div>
                
                <div class="grid grid-3 gap-4">
                    <div class="form-group">
                        <label class="form-label" for="hotel-guests"><i class="fas fa-users"></i> Guests</label>
                        <select id="hotel-guests" class="form-control" required>
                            <option value="1">1 Guest</option>
                            <option value="2" selected>2 Guests</option>
                            <option value="3">3 Guests</option>
                            <option value="4">4 Guests</option>
                            <option value="5+">5+ Guests</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="hotel-rooms"><i class="fas fa-bed"></i> Rooms</label>
                        <select id="hotel-rooms" class="form-control" required>
                            <option value="1">1 Room</option>
                            <option value="2">2 Rooms</option>
                            <option value="3">3 Rooms</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="room-type"><i class="fas fa-star"></i> Room Type</label>
                        <select id="room-type" class="form-control" required>
                            <option value="standard">Standard</option>
                            <option value="deluxe">Deluxe</option>
                            <option value="suite">Suite</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="hotel-requests"><i class="fas fa-sticky-note"></i> Special Requests (Optional)</label>
                    <textarea id="hotel-requests" class="form-control" rows="3" placeholder="Early check-in, airport shuttle, etc..."></textarea>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm text-gray-600">Estimated Total</p>
                            <strong class="text-xl" id="hotel-total-price">$0.00</strong>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Per Night</p>
                            <span id="hotel-night-price">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button class="btn btn-secondary btn-full" onclick="cancelHotelBooking()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-warning btn-full" onclick="submitHotelBooking()">
                        <i class="fas fa-check-circle"></i> Book Hotel
                    </button>
                </div>
            </div>
        </div>

        <!-- Restaurant Discovery Section -->
        <div class="card" id="restaurant-discovery" style="display:none; margin-top: 25px; border-top: 4px solid #e67e22;">
            <div class="card-header">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h3 class="card-title"><i class="fas fa-utensils"></i> Nearby Restaurants</h3>
                        <p class="card-subtitle">Discover and book tables at partner restaurants</p>
                    </div>
                    <button class="btn btn-secondary" style="width:auto" onclick="hideRestaurantDiscovery()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
            
            <div class="mb-4">
                <div class="flex gap-2">
                    <input type="text" id="restaurantSearch" class="form-control" placeholder="Search restaurants..." 
                           onkeyup="searchRestaurants()">
                    <select id="restaurantCuisine" class="form-control" style="width: 200px;" onchange="filterRestaurants()">
                        <option value="">All Cuisines</option>
                        <option value="Ethiopian">Ethiopian</option>
                        <option value="International">International</option>
                        <option value="Italian">Italian</option>
                        <option value="Asian">Asian</option>
                        <option value="Fast Food">Fast Food</option>
                    </select>
                </div>
            </div>
            
            <div id="restaurant-grid" class="grid grid-3" style="margin-top:15px;">
                <p class="text-center text-gray-400 col-span-3">Loading restaurants...</p>
            </div>
            
            <div class="mt-4 text-center">
                <button class="btn btn-outline" onclick="loadMoreRestaurants()">
                    <i class="fas fa-plus"></i> Load More Restaurants
                </button>
            </div>
        </div>

        <!-- Restaurant Booking Form -->
        <div id="res-booking-form" class="card" style="display:none; margin-top: 20px; border-top: 4px solid #e67e22;">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-calendar-alt"></i> Confirm Table Reservation</h3>
                <p class="card-subtitle">Complete your restaurant booking</p>
            </div>
            
            <div class="space-y-4">
                <div class="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-500">
                    <p class="text-sm text-gray-600">Restaurant:</p>
                    <strong class="text-lg" id="selected-res-name"></strong>
                </div>
                
                <input type="hidden" id="ext-res-id">
                
                <div class="form-group">
                    <label class="form-label" for="guest-count"><i class="fas fa-users"></i> Number of Guests</label>
                    <input type="number" id="guest-count" class="form-control" value="2" min="1" max="20">
                </div>
                
                <div class="grid grid-2 gap-4">
                    <div class="form-group">
                        <label class="form-label" for="res-date"><i class="fas fa-calendar"></i> Reservation Date</label>
                        <input type="date" id="res-date" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="res-time"><i class="fas fa-clock"></i> Reservation Time</label>
                        <select id="res-time" class="form-control" required>
                            <option value="">Select a time</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="18:30">6:30 PM</option>
                            <option value="19:00">7:00 PM</option>
                            <option value="19:30">7:30 PM</option>
                            <option value="20:00">8:00 PM</option>
                            <option value="20:30">8:30 PM</option>
                            <option value="21:00">9:00 PM</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="special-requests"><i class="fas fa-sticky-note"></i> Special Requests (Optional)</label>
                    <textarea id="special-requests" class="form-control" rows="3" placeholder="Any dietary requirements or special requests..."></textarea>
                </div>
                
                <div class="flex gap-3">
                    <button class="btn btn-secondary btn-full" onclick="cancelReservation()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-warning btn-full" onclick="submitRestaurantBooking()">
                        <i class="fas fa-check-circle"></i> Confirm Reservation
                    </button>
                </div>
            </div>
        </div>

        <!-- All Bookings History -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-history"></i> My Booking History</h3>
                <p class="card-subtitle">View all your taxi, hotel, and restaurant bookings</p>
            </div>
            
            <!-- Tabs for different booking types -->
            <div class="tabs mb-4">
                <button class="tab-btn active" onclick="showBookingTab('taxi')">Taxi Rides</button>
                <button class="tab-btn" onclick="showBookingTab('hotel')">Hotel Stays</button>
                <button class="tab-btn" onclick="showBookingTab('restaurant')">Restaurant Reservations</button>
            </div>
            
            <!-- Taxi Bookings -->
            <div id="taxi-bookings" class="booking-tab">
                <div id="bookingList">
                    <p class="text-center text-gray-400">Loading taxi bookings...</p>
                </div>
            </div>
            
            <!-- Hotel Bookings -->
            <div id="hotel-bookings" class="booking-tab" style="display: none;">
                <div id="hotelBookingList">
                    <p class="text-center text-gray-400">No hotel bookings yet</p>
                </div>
            </div>
            
            <!-- Restaurant Bookings -->
            <div id="restaurant-bookings" class="booking-tab" style="display: none;">
                <div id="restaurantBookingList">
                    <p class="text-center text-gray-400">No restaurant reservations yet</p>
                </div>
            </div>
            
            <button class="btn btn-secondary btn-full mt-3" onclick="refreshAllBookings()">
                <i class="fas fa-sync-alt"></i> Refresh All Bookings
            </button>
        </div>
    </div>

    <!-- Floating dashboard button -->
    <div id="floatingDashboard" class="floating-dashboard-btn" style="display: none;">
        <button onclick="window.location.href='manager.html'" class="btn btn-warning" title="Go to Manager Dashboard">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
        </button>
    </div>

    <!-- Service Navigation Tabs -->
    <div class="service-nav-tabs">
        <div class="container">
            <div class="service-tabs">
                <button class="service-tab active" onclick="showService('taxi')">
                    <i class="fas fa-taxi"></i>
                    <span>Taxi Services</span>
                </button>
                <button class="service-tab" onclick="showService('hotel')">
                    <i class="fas fa-hotel"></i>
                    <span>Hotels</span>
                </button>
                <button class="service-tab" onclick="showService('restaurant')">
                    <i class="fas fa-utensils"></i>
                    <span>Restaurants</span>
                </button>
            </div>
        </div>
    </div>
    <script src="../js/main.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date pickers
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = ['res-date', 'check-in', 'check-out'];
            dateInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.min = today;
                }
            });
            
            // Set default check-in to tomorrow, check-out to day after
            const checkIn = document.getElementById('check-in');
            const checkOut = document.getElementById('check-out');
            if (checkIn && checkOut) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                checkIn.value = tomorrow.toISOString().split('T')[0];
                
                const dayAfter = new Date(tomorrow);
                dayAfter.setDate(dayAfter.getDate() + 1);
                checkOut.value = dayAfter.toISOString().split('T')[0];
            }
            
            // Show dashboard button for managers
            if (SessionManager.getCurrentUser()?.role === 'manager') {
                document.getElementById('userDashboardBtn').style.display = 'inline-block';
                document.getElementById('floatingDashboard').style.display = 'block';
            }
        });
    </script>
</body>
</html>